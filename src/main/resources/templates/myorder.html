<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>米乐宠物商城</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        .carousel-inner .item img {
            width: 100%; /* or width: 100% !important; */
        }
        .storecontentleft{
            top:50px;
            height: 80%;
            width:40%;
            position: absolute;
            left:5%;
            background-color: #fffbf9;
        }
        .storecontentright{
            top:50px;
            height: 80%;
            width:40%;
            position: absolute;
            right:10%;
            background-color: #f5fff9;
        }
        .hse1{ color:red}
        .price{
            top:300px;
            height: 20%;
            width:90%;
            background-color: #fff7f3;
        }
        .myfoot{
                   margin-left: 10%;
                   width: 80%;
                   height: 70px;
                   position: absolute;
                   bottom:0;
                   left: 0;
               }
    </style>

</head>

<body th:style="'background:url('+ '/petstore/assets/global/img/bg.jpg'+ ');'">
<div class="storeheader">
<nav class="navbar navbar-default" >
    <div class="container-fluid" >
        <ul class="nav navbar-nav navbar-right">
        <li class="dropdown" >
        				<a href="#" class="dropdown-toggle" data-toggle="dropdown">
        					<span th:text="${session.LOGIN_USER.getName()}"/> <b class="caret"></b>
        				</a>
        				<ul class="dropdown-menu">
        					<li><a href="/petstore/user/modifyPassword">修改密码</a></li>
        				</ul>
        			</li>
            <li><a th:href="@{/cart/myCart(userId=${session.LOGIN_USER.getId()})}"><span class="glyphicon glyphicon-shopping-cart"></span>我的购物车</a></li>
            <li><a th:href="@{/user/logOut}"><span class="glyphicon glyphicon-log-out"></span>退出</a></li>
        </ul>
        <div class="navbar-header" style="margin-left: 10%;margin-right: 10%">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" th:href="@{/item/list}">米乐宠物商城</a>
            <img th:src="@{/assets/global/img/logo.jpg}"  width="70" height="50">
        </div>
        <div class="collapse navbar-collapse" id="myNavbar" >
            <ul class="nav navbar-nav">
                <li class="dropdown" >
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        狗狗 <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a th:href="@{/item/listByCategory(category=1)}">狗粮</a></li>
                        <li class="divider"></li>
                        <li><a th:href="@{/item/listByCategory(category=2)}">狗狗玩具</a></li>
                        <li class="divider"></li>
                        <li><a th:href="@{/item/listByCategory(category=3)}">出行装备</a></li>
                    </ul>
                </li>
                <li class="dropdown" >
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        猫咪 <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a th:href="@{/item/listByCategory(category=4)}">猫粮</a></li>
                        <li class="divider"></li>
                        <li><a th:href="@{/item/listByCategory(category=5)}">猫猫玩具</a></li>
                        <li class="divider"></li>
                        <li><a th:href="@{/item/listByCategory(category=6)}">出行装备</a></li>
                    </ul>
                </li>
                <form class="navbar-form navbar-right" action="/item/selectByKey" role="search">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search">
                    </div>
                    <button type="submit" class="btn btn-default">搜索</button>
                </form>
            </ul>
        </div>
    </div>
</nav>
</div>

<div class="storecontent" >
    <div class="storecontentleft">
        <img th:src="@{/img/zhifu.png}" th:width="300" th:height="300" th:align="center">
    </div>
    <div class="storecontentright">
        <h5>
            已成功生成您的订单
        </h5>
        <h4>
            <div>
                订单号：<label class="control-label" th:text="${session.orderVO.getOrderNo()}" id="orderNo"/>
            </div>
            <br />
            <div>
                订单创建时间：<label class="control-label" th:text="${session.orderVO.getCreateTime()}" />
            </div>
            <br />
            <div>
                订单金额:<label class="control-label" th:text="${session.orderVO.getPayment()}"/>
            </div>
            <br />
            <div>
                收获信息: 收货人<label class="control-label" th:text="${session.orderVO.getUserAddressDO().receiverName}"/>
            </div>
            <br />
            <div>
                联系电话<label class="control-label" th:text="${session.orderVO.getUserAddressDO().receiverPhone}"/>
            </div>
            <br />
            <div>
                地址<label class="control-label" th:text="${session.orderVO.getUserAddressDO().toString()}"/>
            </div>
            <br />
            <button class="btn  btn-success btn-lg"  type="button" id = "pay">
                完成支付
            </button>
        </h4>
</div>

</div>
</div>
</body>
<script>
    var orderNo = window.document.getElementById("orderNo").val;
    console.log(orderNo);
    jQuery(document).ready(function() {

        $("#pay").on("click",function(){
            $.ajax({
                url : 'http://localhost:8090/petstore/order/completePay',
                type : 'POST',
                data:{
                  orderNo:$("#orderNo").html().trim(),
                },
                contentType:"application/x-www-form-urlencoded",
                xhrFields:{withCredentials:true},
                success : function(data) {
                    if(data.status == "success"){
                        alert("您已成功完成支付,继续购物");
                        window.location.href ="/petstore/item/list"
                    }
                    else {
                        alert("支付失败，请重试");
                    }
                },
            });
        });
    });
</script>
</html>
