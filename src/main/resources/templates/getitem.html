<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<script th:src="@{/assets/global/plugins/jquery-1.11.0.min.js}" type="text/javascript"></script>
	<link th:href="@{/assets/global/plugins/bootstrap/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>
	<link th:href="@{/assets/global/css/components.css}" rel="stylesheet" type="text/css"/>
	<link th:href="@{/assets/admin/pages/css/login.css}" rel="stylesheet" type="text/css"/>
</head>


<body class="login">
	<div class="content">
		<h3 class="form-title">商品详情</h3>


	<div class="form-group">
			<label class="control-label">商品Id</label>
			<div>
				<label class="control-label" th:text="${session.itemVO.id}" th:value="${session.itemVO.id}" id="itemId"/>
			</div>
	</div>

	<div class="form-group">
		<label class="control-label">商品名</label>
		<div>
			<label class="control-label" th:text="${session.itemVO.title}" id="title"/>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label">商品描述</label>
		<div>
			<label class="control-label" th:text="${session.itemVO.getDescription()}" id="description"/>
		</div>
	</div>
	<div  id = "normalPriceContainer" class="form-group">
		<label  class="control-label">价格</label>
		<div>
			<label class="control-label" th:text="${session.itemVO.price}" id="price"/>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label">图片</label>
		<div>
			<img style="width:200px;height:auto"  th:src="@{${session.itemVO.imgUrl}}" id="imgUrl"/>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label">销量</label>
		<div>
			<label class="control-label" th:text="${session.itemVO.sales}" id="sales"/>
		</div>
	</div>
	<div class="form-actions">
		<button class="btn blue" id="addItemtoCart" type="submit">
			加入购物车
		</button>
	</div>
	</div>
</body>
<script>
    var lable = document.getElementById("itemId");
    var id = lable.innerHTML.trim();
	console.log(id);
	jQuery(document).ready(function(){
		//添加商品至购物车
		$("#addItemtoCart").on("click",function()
		{
			$.ajax({
				type:"POST",
				contentType:"application/x-www-form-urlencoded",
				url:"http://localhost:8090/petstore/cart/addItemToCart",
				data:{
					"itemId":id,
					"amount":1,
				},
				xhrFields:{withCredentials:true},
				success:function(data){
					if(data.status == "success"){
						alert("已添加入购物车");
						window.location.reload();
					}else{
						alert("添加购物车失败"+data.data.errMsg);
						if(data.data.errCode == 20003){
                            window.location.reload();
						}
					}
				},
				error:function(data){
					alert("添加购物车失败"+data.responseTex);
				}
			});
			return false;
			});
		});	
</script>

</html>